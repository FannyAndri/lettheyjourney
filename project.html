<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Perjalanan Magang ‚Äî Kejutan Final</title>

<!-- Tailwind CDN -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Anime.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
<!-- html2canvas + jsPDF -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
/* -----------------------
   Visual: long, decorative
   ----------------------- */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Playfair+Display:wght@400;600;700&display=swap');

:root{
  --bg-a:#020014;
  --bg-b:#07132a;
  --muted:#9ca3af;
  --accent1:#6d28d9;
  --accent2:#2563eb;
  --gold:#ffd566;
}

/* Reset */
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;background:linear-gradient(180deg,var(--bg-a),var(--bg-b));color:#fff;-webkit-font-smoothing:antialiased}

/* Container */
.container{max-width:1100px;margin:0 auto;padding:28px;position:relative;z-index:6}

/* Topbar */
.topbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;gap:12px}
.logo{display:flex;align-items:center;gap:12px}
.logo-badge{width:46px;height:46px;border-radius:12px;background:linear-gradient(90deg,var(--accent2),var(--accent1));display:flex;align-items:center;justify-content:center;font-weight:800;color:#fff;box-shadow:0 10px 30px rgba(109,40,217,0.18)}
.top-meta{font-size:13px;color:var(--muted)}
.btn{padding:10px 16px;border-radius:999px;background:linear-gradient(90deg,var(--accent1),var(--accent2));border:none;color:#fff;cursor:pointer;font-weight:700;box-shadow:0 14px 40px rgba(0,0,0,0.45)}
.btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);box-shadow:none}

/* Slides */
.slide{display:none;min-height:72vh;padding:32px;align-items:center;justify-content:center;text-align:center;position:relative}
.slide.active{display:flex;flex-direction:column}

/* Parallax / background layers */
.stars{position:fixed;inset:0;z-index:0;pointer-events:none;background-image:radial-gradient(#ffffff12 1px, transparent 1px);background-size:6px 6px;opacity:0.45;mix-blend-mode:screen;animation:panStars 120s linear infinite}
@keyframes panStars{from{transform:translate(0,0)}to{transform:translate(-600px,-360px)}}
.nebula{position:fixed;inset:0;z-index:0;pointer-events:none;background:
  radial-gradient(circle at 10% 20%, rgba(130,88,255,0.08), transparent 10%),
  radial-gradient(circle at 80% 60%, rgba(37,99,235,0.06), transparent 12%);filter:blur(44px);opacity:0.82;animation:nebFloat 40s ease-in-out infinite alternate}
@keyframes nebFloat{from{transform:translateY(-8px)}to{transform:translateY(8px)}}

/* Sign-in card */
.signin-card{max-width:780px;margin:0 auto;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));border-radius:18px;padding:22px;border:1px solid rgba(255,255,255,0.04);backdrop-filter:blur(10px);box-shadow:0 20px 80px rgba(0,0,0,0.6)}

/* Fancy heading */
.cipher{font-family:'Playfair Display',serif;background:linear-gradient(90deg,var(--gold),#fff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:1.2px;font-weight:700}

/* Portal multi-layer + shards */
.portal{width:380px;height:380px;border-radius:999px;margin:18px auto;position:relative;overflow:visible;cursor:pointer;display:flex;align-items:center;justify-content:center}
.portal .ring{position:absolute;border-radius:999px;display:flex;align-items:center;justify-content:center;pointer-events:none}
.portal .ring.r1{width:380px;height:380px;box-shadow:0 0 140px rgba(109,40,217,0.26);border:4px solid rgba(109,40,217,0.10)}
.portal .ring.r2{width:300px;height:300px;box-shadow:0 0 110px rgba(37,99,235,0.16);border:3px solid rgba(37,99,235,0.08)}
.portal .ring.r3{width:230px;height:230px;box-shadow:0 0 160px rgba(255,213,102,0.08);border:2px solid rgba(255,213,102,0.06)}
.portal .core{width:160px;height:160px;border-radius:999px;background:radial-gradient(circle, rgba(255,215,102,0.22), rgba(255,215,102,0.05));display:flex;align-items:center;justify-content:center;z-index:6;backdrop-filter: blur(2px)}
.shard{position:absolute;width:18px;height:40px;background:linear-gradient(180deg,#fff,rgba(255,255,255,0.2));opacity:0.12;transform-origin:center;filter:blur(0.6px)}

/* Timeline slideshow */
.timeline-wrap{max-width:980px;margin:0 auto}
.timeline-frame{position:relative;width:920px;max-width:95%;height:460px;margin:0 auto;border-radius:14px;overflow:hidden;border:1px solid rgba(255,255,255,0.04);box-shadow:0 30px 90px rgba(0,0,0,0.6);background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01))}
.timeline-slide{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;padding:20px;opacity:0;transform:scale(0.98)}
.timeline-slide.is-active{opacity:1;transform:scale(1)}
.timeline-img{width:100%;height:100%;object-fit:cover;filter:grayscale(6%);opacity:0.95}
.timeline-caption{position:absolute;left:20px;bottom:20px;background:linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.25));padding:12px;border-radius:10px;color:#fff;max-width:60%;backdrop-filter:blur(4px)}

/* Gallery */
.gallery-grid img{width:100%;height:160px;object-fit:cover;border-radius:10px;display:block}

/* Certificate decorative style */
#certificate{background:linear-gradient(180deg,#fff,#fbfbfc);color:#0b1220;padding:28px;border-radius:14px;width:980px;max-width:95%;margin:0 auto;box-shadow:0 30px 90px rgba(0,0,0,0.6);border:12px solid rgba(255,213,79,0.12);position:relative}
.cert-emoji{position:absolute;font-size:28px}
.cert-emoji.tl{left:18px;top:18px}
.cert-emoji.tr{right:18px;top:18px}
.cert-emoji.bl{left:18px;bottom:18px}
.cert-emoji.br{right:18px;bottom:18px}
.cert-title{font-family:'Playfair Display',serif;font-size:30px;color:#111827}

/* Scroll secret (hidden message) */
#scrollWrap{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:220;pointer-events:none}
.scroll{width:760px;max-width:92%;background:linear-gradient(180deg,#fffaf0,#fff5e6);color:#3b2f0b;padding:24px;border-radius:10px;border:6px solid #e8d7b1;box-shadow:0 30px 80px rgba(0,0,0,0.6);transform-origin:center;opacity:0;transform:scale(0.8) rotateX(90deg);pointer-events:auto}
.scroll .close{position:absolute;right:14px;top:8px;background:transparent;border:none;font-size:18px;cursor:pointer}

/* Easter egg icon */
#egg{position:fixed;right:18px;bottom:18px;width:48px;height:48px;border-radius:10px;background:linear-gradient(90deg,var(--accent2),var(--accent1));display:flex;align-items:center;justify-content:center;box-shadow:0 18px 40px rgba(0,0,0,0.4);cursor:pointer;z-index:230}

/* fireworks canvas wrapper */
#fx-wrap{position:fixed;inset:0;pointer-events:none;z-index:190}

/* small screens */
@media (max-width:900px){ .portal{width:300px;height:300px} .portal .ring.r1{width:300px;height:300px} .timeline-frame{height:360px} }
@media (max-width:600px){ .signin-card{padding:16px} .timeline-caption{max-width:80%} .portal{width:260px;height:260px} }
</style>
</head>
<body>

<!-- Background layers -->
<div class="stars" aria-hidden="true"></div>
<div class="nebula" aria-hidden="true"></div>

<!-- FX canvas -->
<div id="fx-wrap"><canvas id="fx" style="width:100%;height:100%;"></canvas></div>

<!-- Scroll secret (hidden initially) -->
<div id="scrollWrap" class="hidden" aria-hidden="true">
  <div class="scroll" id="scrollBox">
    <button class="close" id="closeScroll">‚úï</button>
    <h3 style="font-family:'Playfair Display', serif; font-size:22px; margin-bottom:8px;">Surat Kecil</h3>
    <p style="line-height:1.6; font-size:16px; margin-bottom:8px;">Jangan lupa mam dan <strong>M I N U M</strong></p>
    <p style="font-size:13px;color:#6b5b3a">‚Äî Sumpah deh, sehat selaluuu yaa</p>
  </div>
</div>

<!-- Easter egg icon -->
<div id="egg" title="Pesan Rahasia (klik!)">üîî</div>

<div class="container">
  <!-- Top bar -->
  <div class="topbar">
    <div class="logo">
      <div class="logo-badge">M</div>
      <div>
        <div class="top-meta">Mysterious Portal</div>
        <div class="top-meta" style="font-size:12px;color:var(--muted)">Hai, Selamat Datang</div>
      </div>
    </div>
    <div class="flex items-center gap-3">
      <button id="btnRestart" class="btn secondary" title="Restart">‚Ü∫ Restart</button>
      <button id="btnMute" class="btn secondary" title="Mute / Unmute">üîä</button>
    </div>
  </div>

  <!-- SLIDES -->

  <!-- SIGN-IN -->
  <section id="slide-signin" class="slide active" style="display:flex;align-items:center;justify-content:center;">
    <div class="signin-card">
      <h2 class="cipher text-3xl mb-2">Guest Check</h2>
      <p class="text-gray-300 mb-4">Masukkan namamu ‚Äî hanya terlihat olehmu.</p>
      <div class="flex gap-3 items-center">
        <input id="inputName" type="text" placeholder="Contoh: Rina Putri" class="flex-1 px-4 py-3 rounded-lg text-black" />
        <button id="btnSignin" class="btn">Masuk</button>
      </div>
      <div class="mt-4 flex gap-3 justify-center">
        <button id="btnGuest" class="btn secondary">Lanjut sebagai tamu</button>
        <button id="btnWhy" class="btn secondary">Kenapa Nama?</button>
      </div>
      <p class="text-xs text-gray-400 mt-3">Nama ini akan selalu terkenang.</p>
    </div>
  </section>

  <!-- INTRO / PORTAL -->
  <section id="slide-intro" class="slide hidden">
    <div>
      <div class="cipher text-5xl mb-6">SEBUAH PERJALANAN</div>
      <p class="text-gray-300 mb-6 max-w-xl mx-auto">Coba Klik Buka Portal, Moudy.</p>

      <div id="portal" class="portal" role="button" aria-label="Portal Mewah">
        <div class="ring r1"></div>
        <div class="ring r2"></div>
        <div class="ring r3"></div>
        <div class="core"><div style="font-weight:700;color:rgba(255,255,255,0.92)">‚ñ∂</div></div>
        <!-- decorative shards -->
        <!-- generate shards with JS for variety -->
      </div>

      <div class="flex gap-3 justify-center mt-6">
        <button id="btnOpenPortal" class="btn">Buka Portal</button>
        <button id="btnSkipPortal" class="btn secondary">Lewati</button>
      </div>
    </div>
  </section>

  <!-- TIMELINE SLIDESHOW -->
  <section id="slide-timeline" class="slide hidden">
    <div class="timeline-wrap">
      <h2 class="cipher text-3xl mb-4">Ruang Antara ‚Äî Perjalanan Selama Magang</h2>
      <p class="text-gray-300 mb-6 max-w-2xl mx-auto">Hal-Hal Yang Telah Kamu Lewati Sejauh Ini.</p>

      <div id="timelineFrame" class="timeline-frame"></div>

      <div class="slideshow-controls mt-4">
        <button id="tlPrev" class="btn secondary">‚Üê Prev</button>
        <div id="tlDots" class="flex items-center gap-2"></div>
        <button id="tlNext" class="btn secondary">Next ‚Üí</button>
      </div>

      <div class="flex gap-3 justify-center mt-6">
        <button class="btn secondary" data-back>‚Üê Back</button>
        <button class="btn" data-next>Next ‚Üí</button>
      </div>
    </div>
  </section>

  <!-- GALLERY -->
  <section id="slide-gallery" class="slide hidden">
    <div>
      <h2 class="cipher text-3xl mb-4">Potongan Kenangan</h2>
      <p class="text-gray-300 mb-6">Potret perjalananmu yang membanggakan.</p>

      <div class="grid grid-cols-2 md:grid-cols-3 gap-4 gallery-grid mb-6">
        <div class="rounded-lg overflow-hidden relative cursor-pointer gallery-item" data-cap="Dori Dori Dori, DORIIIIII"><img src="Gambar1.jpg" alt="1"/></div>
        <div class="rounded-lg overflow-hidden relative cursor-pointer gallery-item" data-cap="Bermain layangan (ga naik naik jir)"><img src="Gambar2.jpg" alt="2"/></div>
        <div class="rounded-lg overflow-hidden relative cursor-pointer gallery-item" data-cap="Mam bersama"><img src="Gambar3.jpg" alt="3"/></div>
        <div class="rounded-lg overflow-hidden relative cursor-pointer gallery-item" data-cap="Hari-hari nda bisa tidur"><img src="Gambar4.jpg" alt="4"/></div>
        <div class="rounded-lg overflow-hidden relative cursor-pointer gallery-item" data-cap="MENGINAPPPPPPP"><img src="Gambar5.jpg" alt="5"/></div>
        <div class="rounded-lg overflow-hidden relative cursor-pointer gallery-item" data-cap="Ice Cream Time"><img src="Gambar6.jpg" alt="6"/></div>
      </div>

      <div id="galleryCaption" class="text-gray-200 italic mb-6 min-h-[48px]"></div>

      <div class="flex gap-3 justify-center mt-6">
        <button class="btn secondary" data-back>‚Üê Back</button>
        <button class="btn" data-next>Next ‚Üí</button>
      </div>
    </div>
  </section>

  <!-- CELEBRATE -->
  <section id="slide-celebrate" class="slide hidden">
    <div>
      <h2 class="cipher text-4xl mb-4">üéâ SELAMAT YAAA!</h2>
      <p class="text-gray-300 mb-6">Kamu kan sudah menapaki magang selama 3 bulan ini. Coba tekan Mulai Perayaan dulu.</p>
      <div class="flex gap-3 justify-center mb-4">
        <button id="btnParty" class="btn">Mulai Perayaan</button>
        <button class="btn secondary" data-next>Ke Ucapan ‚Üí</button>
      </div>
      <div class="text-gray-400 text-sm">Jika musik terblokir, klik halaman satu kali lalu tekan Perayaan lagi.</div>
    </div>
  </section>

  <!-- ROMANCE / UCAPAN (fireworks interactive) -->
  <section id="slide-romance" class="slide hidden">
    <div style="position:relative;z-index:6">
      <h2 id="romTitle" class="cipher text-3xl mb-4">Untukmu, setelah 3 bulan yang melelahkan sekaligus menyenangkan</h2>

      <!-- Replace image url manually if desired -->
      <img id="romPhoto" src="Moudy.jpg" alt="Foto" class="rounded-2xl shadow-2xl w-72 h-72 object-cover mb-6 mx-auto border-4 border-white/10" />

      <div id="romText" class="text-gray-100 mb-6 max-w-3xl mx-auto text-left"></div>

      <div class="flex gap-3 justify-center mt-6">
        <button class="btn secondary" data-back>‚Üê Back</button>
        <button class="btn" data-next>Next ‚Üí</button>
      </div>
      <div class="text-xs text-gray-400 mt-4">Coba kamu klik-klik di sekitar, mana aja, nanti ada yang muncul üéÜ</div>
    </div>
  </section>

  <!-- CERTIFICATE -->
  <section id="slide-cert" class="slide hidden">
    <div>
      <h2 class="cipher text-3xl mb-4">Sertifikat Perayaan</h2>

      <div id="certificate" class="mb-6">
        <div class="cert-emoji tl">üéâ</div>
        <div class="cert-emoji tr">üíº</div>
        <div class="cert-emoji bl">üåü</div>
        <div class="cert-emoji br">üèÖ</div>

        <div style="padding:18px;">
          <div class="cert-title text-center mb-4">SERTIFIKAT UNTUK ORANG TERHEBAT</div>
          <p class="text-center text-gray-600 mb-4">Diberikan kepada</p>
          <div id="certificateName" style="font-family:'Playfair Display', serif; font-size:34px; text-align:center; color:#111827; font-weight:700; margin-bottom:10px;">YOUR NAME</div>
          <p class="text-center text-gray-700 mb-8">Atas kehebatan, kesabaran, dan seluruh semangatmu selama 3 bulan terakhir, menjadi seseorang yang sangat hebat, tangguh, serta kuat.</p>

          <!-- inside-jokes block -->
          <div style="background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:12px; border-radius:10px; margin-bottom:12px;">
            <p style="color:#374151; font-weight:700;">Dewan Anti-Ngoding Nasional</p>
            <p style="font-size:13px; color:#6b7280; margin-top:6px;">Tambahan: "Kamu begadang mulu, mata pandamu tambah gede nanti, pulang istirahat sana yang banyak"</p>
          </div>

          <div style="display:flex;justify-content:space-between;align-items:center;">
            <div style="text-align:left">
              <div style="font-weight:700;color:#374151">Para Saksi Perjalananmu</div>
              <div style="font-size:12px;color:#6b7280">(Tanda tangan)</div>
            </div>
            <div style="text-align:right;color:#6b7280">
              <div style="font-size:12px">Dikeluarkan pada</div>
              <div id="certificateDate" style="font-weight:700;color:#374151"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="flex gap-3 justify-center">
        <button class="btn secondary" data-back>‚Üê Back</button>
        <button id="btnDownload" class="btn">üì• Unduh Sertifikat</button>
      </div>
    </div>
  </section>

</div> <!-- container end -->

<!-- Audio tracks (Pixabay free) -->
<audio id="audioMyst" loop preload="auto">
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_3c9c0e7d2f.mp3?filename=mystical-ambient-110997.mp3" type="audio/mpeg">
</audio>
<audio id="audioCelebrate" preload="auto">
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_0e5b3ec92e.mp3?filename=party-upbeat-111005.mp3" type="audio/mpeg">
</audio>
<audio id="audioRom" loop preload="auto">
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_b4a2d646d8.mp3?filename=romantic-background-110988.mp3" type="audio/mpeg">
</audio>

<script>
/* ======================================================
   Final script: slides, portal shards, timeline slideshow,
   adaptive music, fireworks interactive, secret scroll, certificate PDF
   ====================================================== */

/* Helpers */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));

/* Slides */
const slides = $$('section.slide');
let curIndex = slides.findIndex(s => s.id === 'slide-signin'); // 0

/* Audio refs */
const audioMyst = document.getElementById('audioMyst');
const audioCelebrate = document.getElementById('audioCelebrate');
const audioRom = document.getElementById('audioRom');
audioMyst.volume = 0.32;
audioCelebrate.volume = 0.95;
audioRom.volume = 0.5;

let muted = false;
$('#btnMute').addEventListener('click', () => {
  muted = !muted;
  $('#btnMute').textContent = muted ? 'üîà' : 'üîä';
  [audioMyst, audioCelebrate, audioRom].forEach(a => { if (a) a.muted = muted; });
});
$('#btnRestart').addEventListener('click', () => {
  $('#inputName').value = '';
  $('#certificateName').textContent = 'YOUR NAME';
  showSlide(0);
});

/* showSlide with anime transition */
function showSlide(i) {
  if (i < 0) i = 0;
  if (i >= slides.length) i = slides.length - 1;
  if (i === curIndex) return;
  const outEl = slides[curIndex];
  const inEl = slides[i];
  try {
    anime({ targets: outEl, opacity: [1,0], scale: [1,0.98], duration: 420, easing: 'easeInQuad', complete: ()=> { outEl.style.display='none'; outEl.classList.remove('active'); }});
  } catch(e){ outEl.style.display='none'; }
  inEl.style.display = 'flex';
  inEl.style.opacity = 0;
  inEl.style.transform = 'scale(0.98)';
  inEl.classList.add('active');
  try {
    anime({ targets: inEl, opacity: [0,1], scale: [0.98,1], duration: 680, delay: 120, easing: 'easeOutCubic' });
  } catch(e) { inEl.style.opacity = 1; inEl.style.transform = 'none'; }
  curIndex = i;
}

/* ---------- Sign-in logic (ensure audio starts here) ---------- */
$('#btnSignin').addEventListener('click', () => {
  const nm = $('#inputName').value.trim();
  if (!nm) { alert('Mohon isi namamu untuk sertifikat.'); $('#inputName').focus(); return; }
  $('#certificateName').textContent = nm;
  // start mysterious music (gesture)
  if (!muted) try { audioMyst.currentTime = 0; audioMyst.play(); } catch(e){}
  try { anime({ targets: '.signin-card', opacity: [1,0], translateY: [0,-16], duration: 520, easing: 'easeInCubic' }); } catch(e){}
  setTimeout(()=> showSlide(1), 420);
});
$('#btnGuest').addEventListener('click', ()=> {
  $('#inputName').value = 'Tamu Istimewa';
  $('#certificateName').textContent = 'Tamu Istimewa';
  if (!muted) try { audioMyst.currentTime = 0; audioMyst.play(); } catch(e){}
  showSlide(1);
});
$('#btnWhy').addEventListener('click', ()=> alert('Nama hanya dipakai untuk mencetak sertifikat kenangan ‚Äî tidak dipublikasikan.'));
$('#inputName').addEventListener('keydown', (e)=> { if (e.key === 'Enter') $('#btnSignin').click(); });

/* ---------- Portal: shards generation + open sequence ---------- */
const portal = $('#portal');
// generate shards around portal for crystal effect
(function makeShards(){
  if (!portal) return;
  const shardCount = 22;
  for (let i=0;i<shardCount;i++){
    const s = document.createElement('div');
    s.className = 'shard';
    const angle = Math.random()*360; const r = 180 + Math.random()*60;
    s.style.left = '50%'; s.style.top = '50%';
    s.style.transform = `translate(-50%,-50%) rotate(${angle}deg) translateY(-${r}px)`;
    s.style.opacity = 0.06 + Math.random()*0.12;
    s.style.width = (8 + Math.random()*16)+'px';
    s.style.height = (24 + Math.random()*40)+'px';
    portal.appendChild(s);
  }
})();

$('#btnOpenPortal').addEventListener('click', ()=> { if (!muted) try{ audioMyst.currentTime = 0; audioMyst.play(); } catch(e){} openPortal(); });
portal.addEventListener('click', ()=> { if (!muted) try{ audioMyst.currentTime = 0; audioMyst.play(); } catch(e){} openPortal(); });
$('#btnSkipPortal').addEventListener('click', ()=> showSlide(2));

let portalOpened = false;
function openPortal(){
  if (portalOpened) return;
  portalOpened = true;
  try {
    anime.timeline()
      .add({ targets: '.portal .ring.r1', rotate: [0,360], scale: [1,1.06], duration: 900, easing: 'easeOutQuart' })
      .add({ targets: '.portal .ring.r2', rotate: [0,-480], scale: [0.86,1.12], duration: 1000, easing: 'easeOutQuart' }, '-=800')
      .add({ targets: '.portal .ring.r3', rotate: [0,720], scale: [0.72,1.18], duration: 1100, easing: 'easeOutQuart' }, '-=900');
  } catch(e){}

  // burst: emojis & shards animate outward
  const rect = portal.getBoundingClientRect();
  const cx = rect.left + rect.width/2;
  const cy = rect.top + rect.height/2;
  for (let i=0;i<40;i++){
    const el = document.createElement('div');
    el.textContent = ['‚ú®','üéâ','üí´','üîÜ'][Math.floor(Math.random()*4)];
    el.style.position='fixed'; el.style.left = cx + 'px'; el.style.top = cy + 'px';
    el.style.zIndex = 130; el.style.pointerEvents = 'none'; el.style.fontSize = (10 + Math.random()*36) + 'px';
    document.body.appendChild(el);
    anime({ targets: el, translateX: (Math.random()-0.5)*900, translateY: -(120 + Math.random()*700), rotate: (Math.random()>0.5?1:-1)*(120 + Math.random()*900), opacity: [1,0], duration: 1400 + Math.random()*2200, easing: 'easeOutCubic', complete: ()=> el.remove() });
  }

  // quick celebrate music sting then to timeline (mystic continues in background)
  if (!muted) {
    try { audioCelebrate.currentTime = 0; audioCelebrate.play(); } catch(e){}
    setTimeout(()=> { try { audioCelebrate.pause(); audioCelebrate.currentTime = 0; } catch(e){} }, 1600);
  }
  setTimeout(()=> showSlide(2), 1200);
}

/* ---------- Timeline slideshow (per image) ---------- */
const timelineSlides = [
  { img: 'Fase1.jpg', caption: 'Awal-awal magang masih rajin banget ngoding nih, tiap hari ngoding.' },
  { img: 'Fase2.jpg', caption: 'Habis ngoding ternyata belum selesai, kudu ngisi katalog banyak banget.' },
  { img: 'Fase3.jpg', caption: 'Terus juga dihantam sama proposal skripsi yang shit banget itu.' },
  { img: 'Fase4.jpg', caption: 'Dan akhirnya, kamu telah melewati semua itu dan akan segera pulang.' }
];
const timelineFrame = $('#timelineFrame'), tlDots = $('#tlDots');
let tlIndex = 0, tlTimer = null, tlAuto = true;

function buildTimeline(){
  timelineFrame.innerHTML = ''; tlDots.innerHTML = '';
  timelineSlides.forEach((s,i)=>{
    const el = document.createElement('div');
    el.className = 'timeline-slide';
    el.dataset.index = i;
    const img = document.createElement('img'); img.className = 'timeline-img'; img.src = s.img; img.alt = s.caption;
    const cap = document.createElement('div'); cap.className = 'timeline-caption'; cap.innerHTML = `<strong>Fase ${i+1}</strong><div style="margin-top:6px">${s.caption}</div>`;
    el.appendChild(img); el.appendChild(cap);
    timelineFrame.appendChild(el);

    const dot = document.createElement('button'); dot.style.width='10px'; dot.style.height='10px'; dot.style.borderRadius='999px';
    dot.style.background='rgba(255,255,255,0.12)'; dot.title = `Fase ${i+1}`; dot.addEventListener('click', ()=> { tlShow(i); });
    tlDots.appendChild(dot);
  });
  tlShow(0);
  $('#tlPrev').addEventListener('click', tlPrev);
  $('#tlNext').addEventListener('click', tlNext);
  startTlAuto();
}
function tlShow(i) {
  if (i < 0) i = timelineSlides.length - 1;
  if (i >= timelineSlides.length) i = 0;
  tlIndex = i;

  const els = Array.from(timelineFrame.children);
  els.forEach((e, j) => {
    if (j === i) {
      e.classList.add('is-active');
      e.style.opacity = 1;
      e.style.transform = 'scale(1)';
    } else {
      e.classList.remove('is-active');
      e.style.opacity = 0;
      e.style.transform = 'scale(0.98)';
    }
  });

  // update dots
  Array.from(tlDots.children).forEach((d, j) => {
    d.style.background = j === i ? 'rgba(255,255,255,0.8)' : 'rgba(255,255,255,0.12)';
  });
}

function tlPrev() {
  tlShow(tlIndex - 1);
}

function tlNext() {
  tlShow(tlIndex + 1);
}

function startTlAuto() {
  clearInterval(tlTimer);
  tlTimer = setInterval(() => {
    if (tlAuto) tlNext();
  }, 5000); // auto ganti setiap 5 detik
}

function tlNext(){ tlShow((tlIndex+1)%timelineSlides.length); resetTlAuto(); }
function tlPrev(){ tlShow((tlIndex-1+timelineSlides.length)%timelineSlides.length); resetTlAuto(); }
function startTlAuto(){ if (!tlAuto) return; stopTlAuto(); tlTimer = setInterval(()=> tlNext(), 5600); }
function stopTlAuto(){ if (tlTimer) { clearInterval(tlTimer); tlTimer = null; } }
function resetTlAuto(){ stopTlAuto(); startTlAuto(); }
buildTimeline();

/* ---------- Gallery interactions ---------- */
$$('.gallery-item').forEach(it => it.addEventListener('click', ()=> {
  $('#galleryCaption').textContent = it.dataset.cap || '';
  try { anime({ targets: it.querySelector('img'), scale:[1,1.06,1], duration:600, easing:'easeOutCubic' }); } catch(e){}
}));

/* ---------- Celebration button ---------- */
$('#btnParty').addEventListener('click', ()=> {
  if (!muted) try { audioCelebrate.currentTime = 0; audioCelebrate.play(); } catch(e){}
  // burst confetti emoji
  for (let i=0;i<70;i++){
    const e = document.createElement('div');
    e.textContent = ['üéä','‚ú®','üéà','üí´'][Math.floor(Math.random()*4)];
    e.style.position='fixed'; e.style.left = (8 + Math.random()*84) + '%'; e.style.top='-10%'; e.style.zIndex=170; e.style.fontSize=(12+Math.random()*32)+'px'; e.style.pointerEvents='none';
    document.body.appendChild(e);
    anime({ targets: e, translateY:[0, window.innerHeight*0.9], translateX:(Math.random()-0.5)*600, rotate:(Math.random()>0.5?1:-1)*(120+Math.random()*500), opacity:[1,0], duration:2400+Math.random()*2400, easing:'easeOutCubic', complete: ()=> e.remove() });
  }
});

/* ---------- Romance text + interactive fireworks ---------- */
const romText = `Tiga bulan bukan hal sepele: pagi kamu bangun lebih awal, malam yang selalu begadang, tugas yang numpuk, serta keberanian untuk terus berdiri dan berlari. Aku turut merasa bangga atasmu. (ehem, kalo mau Getrich bilang ya hehe :) ).`;
function typeWriter(el, text, speed=18){ el.textContent=''; let i=0; const id=setInterval(()=> { el.textContent += text[i] || ''; i++; if (i>=text.length) clearInterval(id); }, speed); }

/* Fireworks canvas engine */
const canvas = document.getElementById('fx'); const ctx = canvas.getContext('2d');
function resizeCanvas(){ canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
resizeCanvas(); window.addEventListener('resize', resizeCanvas);

let particles = [], lastTS = 0;
class Particle {
  constructor(x,y,dx,dy,color,ttl){ this.x=x; this.y=y; this.dx=dx; this.dy=dy; this.color=color; this.ttl=ttl; this.age=0; this.r = 2 + Math.random()*4; }
  update(dt){ this.age += dt; this.x += this.dx*dt; this.y += this.dy*dt + 0.03*dt*dt; this.dy += 0.03*dt; return this.age < this.ttl; }
  draw(c){ c.save(); c.globalCompositeOperation='lighter'; c.globalAlpha=Math.max(0,1 - (this.age/this.ttl)); c.beginPath(); c.fillStyle = this.color; c.arc(this.x,this.y,this.r,0,Math.PI*2); c.fill(); c.restore(); }
}
function fxLoop(ts){
  if (!lastTS) lastTS = ts;
  const dt = Math.min(4,(ts-lastTS)/16.66);
  lastTS = ts;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for (let i = particles.length-1; i>=0; i--) if (!particles[i].update(dt)) particles.splice(i,1);
  for (const p of particles) p.draw(ctx);
  requestAnimationFrame(fxLoop);
}
requestAnimationFrame(fxLoop);

function spawnFirework(px,py){
  const hue = Math.floor(Math.random()*360);
  const count = 30 + Math.floor(Math.random()*50);
  for (let i=0;i<count;i++){
    const ang = Math.random()*Math.PI*2;
    const sp = 1.6 + Math.random()*6;
    const dx = Math.cos(ang)*sp;
    const dy = Math.sin(ang)*sp;
    const color = `hsl(${hue + (Math.random()*40-20)},80%,60%)`;
    particles.push(new Particle(px,py,dx,dy,color, 60 + Math.random()*140));
  }
  // small DOM confetti
  for (let i=0;i<10;i++){
    const e = document.createElement('div'); e.textContent = ['‚ú®','üéä','üéà','üí´'][Math.floor(Math.random()*4)];
    e.style.position='fixed'; e.style.left = (px + (Math.random()*200 - 100)) + 'px'; e.style.top = (py + (Math.random()*80 - 40)) + 'px';
    e.style.fontSize = (12 + Math.random()*34) + 'px'; e.style.zIndex = 220; e.style.pointerEvents = 'none';
    document.body.appendChild(e);
    anime({ targets: e, translateY: - (200 + Math.random()*400), translateX: (Math.random()-0.5)*400, rotate: (Math.random()>0.5?1:-1)*(120 + Math.random()*400), opacity: [1,0], duration: 1600 + Math.random()*2400, easing:'easeOutCubic', complete: ()=> e.remove() });
  }
}

/* Make fireworks interactive in romance slide */
document.getElementById('slide-romance').addEventListener('click', (ev) => {
  // only spawn if currently on romance slide
  const slideActive = document.querySelector('#slide-romance').classList.contains('active') || document.querySelector('#slide-romance').style.display === 'flex';
  if (!slideActive) return;
  const x = ev.clientX; const y = ev.clientY;
  spawnFirework(x,y);
  // play small sound effect if desired (we reuse celebrate briefly)
  if (!muted) try { audioCelebrate.currentTime = 0; audioCelebrate.play(); setTimeout(()=> { audioCelebrate.pause(); audioCelebrate.currentTime = 0; }, 800); } catch(e){}
});

/* Detect slide changes: play music and typewriter, update certificate date/name */
let lastActive = -1;
setInterval(()=> {
  const active = slides.findIndex(s => s.style.display === 'flex' || s.classList.contains('active'));
  if (active !== lastActive) {
    lastActive = active;
    const id = slides[active]?.id;
    if (id === 'slide-romance') {
      if (!muted) try { audioRom.currentTime = 0; audioRom.play(); } catch(e){}
      const el = $('#romText'); if (el && el.textContent.trim()==='') typeWriter(el, romText, 18);
      // spawn soft fireworks initial
      for (let i=0;i<4;i++) setTimeout(()=> spawnFirework(150 + Math.random()*(window.innerWidth-300), 120 + Math.random()*(window.innerHeight/2)), i*700);
    } else {
      if (audioRom && !audioRom.paused) try { audioRom.pause(); audioRom.currentTime = 0; } catch(e){}
    }
    if (id === 'slide-cert') {
      const nm = ($('#inputName').value && $('#inputName').value.trim()) ? $('#inputName').value.trim() : 'Tamu Istimewa';
      $('#certificateName').textContent = nm;
      const d = new Date(); $('#certificateDate').textContent = d.toLocaleDateString('id-ID', { day:'numeric', month:'long', year:'numeric' });
      // after short delay, show scroll secret (so user sees cert first)
      setTimeout(()=> showScrollSecret(), 1800);
    }
    // if moving to timeline slide, ensure mystical continues and optionally a light beat
    if (id === 'slide-timeline') {
      if (!muted) try { audioMyst.currentTime = 0; audioMyst.play(); } catch(e){}
    }
  }
}, 420);

/* ---------- Next/Back wiring ---------- */
$$('[data-next]').forEach(b => b.addEventListener('click', ()=> showSlide(Math.min(slides.length-1, curIndex+1))));
$$('[data-back]').forEach(b => b.addEventListener('click', ()=> showSlide(Math.max(0, curIndex-1))));

/* ---------- Certificate download (html2canvas + jsPDF) ---------- */
$('#btnDownload').addEventListener('click', async ()=> {
  const btn = $('#btnDownload'); btn.disabled = true; btn.textContent = 'Mempersiapkan...';
  try {
    const el = $('#certificate'); const orig = el.style.boxShadow; el.style.boxShadow = 'none';
    const canvasImg = await html2canvas(el, { scale:2, useCORS:true, backgroundColor: null });
    el.style.boxShadow = orig;
    const data = canvasImg.toDataURL('image/png');
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF({ orientation:'landscape', unit:'px', format: [canvasImg.width, canvasImg.height] });
    pdf.addImage(data, 'PNG', 0, 0, canvasImg.width, canvasImg.height);
    const name = ($('#inputName').value && $('#inputName').value.trim()) ? $('#inputName').value.trim() : 'TamuIstimewa';
    pdf.save(`Sertifikat_Magang_${name.replace(/\s+/g,'_')}.pdf`);
  } catch (err) {
    console.error(err); alert('Gagal membuat sertifikat. Coba lagi.');
  } finally {
    btn.disabled = false; btn.textContent = 'üì• Unduh Sertifikat';
  }
});

/* ---------- Scroll secret (show/hide) ---------- */
function showScrollSecret(){
  const wrap = $('#scrollWrap');
  const box = $('#scrollBox');
  if (!wrap || !box) return;
  // show with animation
  wrap.classList.remove('hidden'); wrap.style.pointerEvents = 'auto'; wrap.setAttribute('aria-hidden','false');
  try {
    anime({ targets: box, opacity: [0,1], scale: [0.8,1], rotateX: ['90deg','0deg'], duration: 800, easing: 'easeOutBack' });
  } catch(e){ box.style.opacity = 1; box.style.transform = 'none'; }
}
$('#closeScroll').addEventListener('click', ()=> {
  const wrap = $('#scrollWrap'); const box = $('#scrollBox');
  try {
    anime({ targets: box, opacity: [1,0], scale: [1,0.8], rotateX: ['0deg','90deg'], duration: 460, easing: 'easeInCubic', complete: ()=> { wrap.classList.add('hidden'); wrap.style.pointerEvents = 'none'; wrap.setAttribute('aria-hidden','true'); }});
  } catch(e){ wrap.classList.add('hidden'); wrap.style.pointerEvents = 'none'; }
});

/* Easter egg icon -> show scroll secret */
$('#egg').addEventListener('click', ()=> {
  showScrollSecret();
});

/* ---------- Small UX: initial play gesture ---------- */
function initialPlay(){ if (!muted) try { audioMyst.currentTime = 0; audioMyst.play(); } catch(e){} window.removeEventListener('click', initialPlay); window.removeEventListener('keydown', initialPlay); }
window.addEventListener('click', initialPlay, { once:true }); window.addEventListener('keydown', initialPlay, { once:true });

/* ---------- Start timeline autoplay fallback ---------- */
/* ensure timeline functions exist in case of duplicated script sections */
let tlIndexLocal = 0, tlTimerLocal = null;
function tlShowLocal(i){
  const slidesEls = Array.from(document.querySelectorAll('#timelineFrame .timeline-slide'));
  slidesEls.forEach(el => el.classList.remove('is-active'));
  const active = slidesEls[i];
  if (!active) return;
  active.classList.add('is-active');
  try { anime({ targets: active, opacity:[0,1], translateX:['12px','0px'], duration:700, easing:'easeOutCubic' }); } catch(e){}
  const dots = Array.from(document.querySelectorAll('#tlDots button'));
  dots.forEach((d,idx)=> d.style.background = idx===i ? 'linear-gradient(90deg,var(--accent1),var(--accent2))' : 'rgba(255,255,255,0.12)');
  tlIndexLocal = i;
}
function tlNextLocal(){ tlShowLocal((tlIndexLocal+1) % timelineSlides.length); }
function startTlAutoLocal(){ if (tlTimerLocal) clearInterval(tlTimerLocal); tlTimerLocal = setInterval(()=> tlNextLocal(), 5200); }
startTlAutoLocal();

/* ---------- Keyboard: navigate slides ---------- */
window.addEventListener('keydown', (e) => {
  if (e.key === 'ArrowRight') showSlide(Math.min(slides.length - 1, curIndex + 1));
  if (e.key === 'ArrowLeft') showSlide(Math.max(0, curIndex - 1));
});

/* End script */
</script>
</body>
</html>
